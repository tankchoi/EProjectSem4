<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Customer Page</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/jquery.dataTables.min.css">
</head>

<body>
    <div class="container-fluid">
        <div class="row">
            <div class="col-12">
                <h1 class="text-center my-4">Customer Management Page Test</h1>

                <!-- Test Table Structure -->
                <div class="card">
                    <div class="card-header">
                        <h5>Customer Data Table</h5>
                    </div>
                    <div class="card-body">
                        <table class="table table-striped" id="customerTable">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Tên đăng nhập</th>
                                    <th>Họ tên</th>
                                    <th>Email</th>
                                    <th>Số điện thoại</th>
                                    <th>Trạng thái</th>
                                    <th>Ngày tạo</th>
                                    <th>Thao tác</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>1</td>
                                    <td>customer1</td>
                                    <td>Nguyen Van A</td>
                                    <td>customer1@email.com</td>
                                    <td>0123456789</td>
                                    <td><span class="badge bg-success">Hoạt động</span></td>
                                    <td>01/01/2024 10:00</td>
                                    <td>
                                        <button class="btn btn-sm btn-primary">Chi tiết</button>
                                        <button class="btn btn-sm btn-warning">Sửa</button>
                                        <button class="btn btn-sm btn-danger">Khóa</button>
                                    </td>
                                </tr>
                                <tr>
                                    <td>2</td>
                                    <td>customer2</td>
                                    <td>Tran Thi B</td>
                                    <td>customer2@email.com</td>
                                    <td>0987654321</td>
                                    <td><span class="badge bg-danger">Đã khóa</span></td>
                                    <td>02/01/2024 15:30</td>
                                    <td>
                                        <button class="btn btn-sm btn-primary">Chi tiết</button>
                                        <button class="btn btn-sm btn-warning">Sửa</button>
                                        <button class="btn btn-sm btn-success">Mở khóa</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Test Export Functionality -->
                <div class="mt-4">
                    <div class="dropdown">
                        <button class="btn btn-outline-primary dropdown-toggle" type="button" id="exportDropdown"
                            data-bs-toggle="dropdown">
                            <span class="material-symbols-outlined">download</span>
                            Xuất dữ liệu
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#" onclick="exportTable('excel')">
                                    <span class="material-symbols-outlined">table_chart</span>
                                    Xuất Excel
                                </a></li>
                            <li><a class="dropdown-item" href="#" onclick="exportTable('pdf')">
                                    <span class="material-symbols-outlined">picture_as_pdf</span>
                                    Xuất PDF
                                </a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script>
        // Initialize DataTable
        $(document).ready(function () {
            $('#customerTable').DataTable({
                language: {
                    search: "Tìm kiếm:",
                    lengthMenu: "Hiển thị _MENU_ dòng",
                    info: "Hiển thị _START_ đến _END_ của _TOTAL_ dòng",
                    infoEmpty: "Hiển thị 0 đến 0 của 0 dòng",
                    emptyTable: "Không có dữ liệu",
                    zeroRecords: "Không tìm thấy dữ liệu phù hợp",
                    paginate: {
                        first: "Đầu",
                        last: "Cuối",
                        next: "Tiếp",
                        previous: "Trước"
                    }
                }
            });
        });

        // Export functionality test
        function exportTable(format) {
            const table = document.getElementById('customerTable');
            const data = [];

            // Get headers
            const headers = [];
            table.querySelectorAll('thead th').forEach((th, index) => {
                if (index < 7) {
                    headers.push(th.textContent.trim());
                }
            });
            data.push(headers);

            // Get data rows
            table.querySelectorAll('tbody tr').forEach(tr => {
                const row = [];
                tr.querySelectorAll('td').forEach((td, index) => {
                    if (index < 7) {
                        row.push(td.textContent.trim());
                    }
                });
                if (row.length > 0) {
                    data.push(row);
                }
            });

            if (format === 'excel') {
                const ws = XLSX.utils.aoa_to_sheet(data);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, "Khách hàng");
                XLSX.writeFile(wb, "test-customer-export.xlsx");
                alert('Excel file exported successfully!');
            } else if (format === 'pdf') {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                doc.setFont("helvetica", "bold");
                doc.setFontSize(16);
                doc.text("DANH SACH KHACH HANG TEST", 20, 20);

                let y = 40;
                data.forEach((row, index) => {
                    if (index === 0) {
                        doc.setFont("helvetica", "bold");
                        doc.setFontSize(10);
                    } else {
                        doc.setFont("helvetica", "normal");
                        doc.setFontSize(8);
                    }

                    const text = row.join(" | ");
                    doc.text(text, 20, y);
                    y += 8;

                    if (y > 280) {
                        doc.addPage();
                        y = 20;
                    }
                });

                doc.save("test-customer-export.pdf");
                alert('PDF file exported successfully!');
            }
        }
    </script>
</body>

</html>