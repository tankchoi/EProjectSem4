<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Quản lý Hóa đơn</title>
    <link rel="stylesheet" th:href="@{/assets/css/admin/pages/laptop/index.css}">
    <link rel="stylesheet" th:href="@{/assets/css/admin/pages/receipt/receipt.css}">
    <link rel="stylesheet" th:href="@{/assets/css/admin/fragments/nav-side.css}">
    <link rel="stylesheet" th:href="@{/assets/css/admin/fragments/nav-top.css}">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/jquery.dataTables.min.css">
</head>

<body>
    <div class="main-container">
        <div th:replace="admin/fragments/nav-side :: nav-side"></div>
        <div th:replace="admin/fragments/nav-top :: nav-top"></div>
        <div class="page-container">
            <div class="page-header">
                <div class="header-content">
                    <h1>Admin /</h1>
                    <h1>Quản lý Hóa đơn</h1>
                </div>
            </div>
            <div class="dashboard-header">
                <div class="dashboard-title">
                    <h1>Danh sách Hóa đơn</h1>
                    <a th:href="@{/admin/receipt/create}"
                        class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
                        Thêm Hóa đơn
                    </a>
                </div>
            </div>

            <!-- Alert messages -->
            <div th:if="${success}" class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4">
                <span th:text="${success}"></span>
            </div>
            <div th:if="${error}" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
                <span th:text="${error}"></span>
            </div>

            <div class="table-container">
                <table id="myTable" class="table-content">
                    <thead>
                        <tr>
                            <th>Mã HĐ</th>
                            <th>Khách hàng</th>
                            <th>Thiết bị</th>
                            <th>Kỹ thuật viên</th>
                            <th>Tổng tiền</th>
                            <th>Trạng thái</th>
                            <th>Ngày tạo</th>
                            <th>Thao tác</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="invoice : ${invoices}">
                            <td th:text="${invoice.id}">1</td>
                            <td th:text="${invoice.request.fullname}">Tên khách hàng</td>
                            <td th:text="${invoice.request.customerLaptop.laptop.name}">Tên laptop</td>
                            <td
                                th:text="${invoice.request.technician != null ? invoice.request.technician.fullname : 'Chưa phân công'}">
                                Kỹ thuật viên</td>
                            <td
                                th:text="${#numbers.formatDecimal(invoice.totalPrice, 0, 'COMMA', 0, 'POINT')} + ' VNĐ'">
                                1,000,000 VNĐ</td>
                            <td>
                                <span th:if="${invoice.status == 'PAID'}"
                                    class="bg-green-100 text-green-800 text-xs font-medium px-2.5 py-0.5 rounded">Đã
                                    thanh toán</span>
                                <span th:if="${invoice.status == 'UNPAID'}"
                                    class="bg-red-100 text-red-800 text-xs font-medium px-2.5 py-0.5 rounded">Chưa thanh
                                    toán</span>
                            </td>
                            <td th:text="${#dates.format(invoice.createdAt, 'dd/MM/yyyy HH:mm')}">12/01/2025</td>
                            <td class="px-2 py-1">
                                <div class="flex gap-2">
                                    <a th:href="@{/admin/receipt/edit/{id}(id=${invoice.id})}"
                                        class="edit-btn flex items-center gap-1 px-2 py-1" title="Chỉnh sửa hóa đơn">
                                        Sửa
                                        <span class="material-symbols-outlined">edit</span>
                                    </a>
                                    <a th:href="@{/admin/receipt/view/{id}(id=${invoice.id})}"
                                        class="view-btn flex items-center gap-1 px-2 py-1" title="Xem chi tiết">
                                        Xem
                                        <span class="material-symbols-outlined">visibility</span>
                                    </a>
                                    <button th:onclick="'confirmDelete(' + ${invoice.id} + ')'"
                                        class="delete-btn flex items-center gap-1 px-2 py-1" title="Xóa hóa đơn">
                                        Xóa
                                        <span class="material-symbols-outlined">delete</span>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        <!-- Hiển thị thông báo khi không có dữ liệu -->
                        <tr th:if="${#lists.isEmpty(invoices)}">
                            <td colspan="8" class="text-center py-4 text-gray-500">Không có hóa đơn nào</td>
                        </tr>
                    </tbody>
                </table>


            </div>


        </div>
    </div>



    <script th:src="@{/assets/js/admin/script.js}"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            new DataTable("#myTable", {
                paging: true,        // Bật phân trang
                searching: true,     // Bật tìm kiếm
                ordering: true,      // Cho phép sắp xếp
                info: true,          // Hiển thị số dòng đang xem
                lengthMenu: [10, 20, 30, 40], // Tùy chọn số dòng hiển thị
                language: {
                    search: "Tìm kiếm:",
                    lengthMenu: "Hiển thị _MENU_ dòng",
                    info: "Hiển thị _START_ đến _END_ của _TOTAL_ dòng",
                    paginate: {
                        first: "Đầu",
                        last: "Cuối",
                        next: "Tiếp",
                        previous: "Trước"
                    }
                }
            });
        });

        function confirmDelete(invoiceId) {
            if (confirm('Bạn có chắc chắn muốn xóa hóa đơn này?')) {
                window.location.href = '/admin/receipt/delete/' + invoiceId;
            }
        }
    </script>
</body>

</html>