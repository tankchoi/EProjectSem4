<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chi tiết khách hàng</title>
    <link rel="stylesheet" th:href="@{/assets/css/admin/pages/customer/view.css}">
    <link rel="stylesheet" th:href="@{/assets/css/admin/fragments/nav-side.css}">
    <link rel="stylesheet" th:href="@{/assets/css/admin/fragments/nav-top.css}">
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <div class="main-container">
        <div th:replace="admin/fragments/nav-side :: nav-side"></div>
        <div th:replace="admin/fragments/nav-top :: nav-top"></div>
        <div class="page-container">
            <div class="page-header">
                <div class="header-content">
                    <span class="material-symbols-outlined">person</span>
                    <h1>Admin / Chi tiết khách hàng</h1>
                </div>
            </div>

            <div class="dashboard-header">
                <div class="dashboard-title">
                    <h1>
                        <span class="material-symbols-outlined"
                            style="vertical-align: middle; margin-right: 8px;">account_circle</span>
                        Chi tiết khách hàng
                    </h1>
                    <p>Xem và quản lý thông tin chi tiết của khách hàng</p>
                </div>
                <div class="action-buttons">
                    <a href="/admin/customer" class="btn-outline-secondary">
                        <span class="material-symbols-outlined">arrow_back</span>
                        Quay lại
                    </a>
                    <a th:href="@{/admin/customer/{id}/edit(id=${customer.id})}" class="btn-warning">
                        <span class="material-symbols-outlined">edit</span>
                        Chỉnh sửa
                    </a>
                </div>
            </div>

            <!-- Breadcrumb -->
            <div class="breadcrumb">
                <ul class="breadcrumb-list">
                    <li class="breadcrumb-item">
                        <a href="/admin/dashboard">
                            <span class="material-symbols-outlined">home</span>
                            Dashboard
                        </a>
                    </li>
                    <li class="breadcrumb-separator">
                        <span class="material-symbols-outlined">chevron_right</span>
                    </li>
                    <li class="breadcrumb-item">
                        <a href="/admin/customer">
                            <span class="material-symbols-outlined">group</span>
                            Khách hàng
                        </a>
                    </li>
                    <li class="breadcrumb-separator">
                        <span class="material-symbols-outlined">chevron_right</span>
                    </li>
                    <li class="breadcrumb-item active">Chi tiết</li>
                </ul>
            </div>

            <div class="page-content">
                <!-- Main Content -->
                <div class="main-content">
                    <!-- Customer Info Card -->
                    <div class="info-card">
                        <div class="card-header">
                            <h3>
                                <span class="material-symbols-outlined">person</span>
                                Thông tin cá nhân
                            </h3>
                        </div>
                        <div class="card-body">
                            <div class="info-grid">
                                <div class="info-item">
                                    <div class="info-label">
                                        <span class="material-symbols-outlined">tag</span>
                                        ID khách hàng:
                                    </div>
                                    <div class="info-value" th:text="${customer.id}">1</div>
                                </div>
                                <div class="info-item">
                                    <div class="info-label">
                                        <span class="material-symbols-outlined">account_circle</span>
                                        Tên đăng nhập:
                                    </div>
                                    <div class="info-value" th:text="${customer.username}">john_doe</div>
                                </div>
                                <div class="info-item">
                                    <div class="info-label">
                                        <span class="material-symbols-outlined">badge</span>
                                        Họ và tên:
                                    </div>
                                    <div class="info-value" th:text="${customer.fullname}">John Doe</div>
                                </div>
                                <div class="info-item">
                                    <div class="info-label">
                                        <span class="material-symbols-outlined">email</span>
                                        Email:
                                    </div>
                                    <div class="info-value">
                                        <a th:href="'mailto:' + ${customer.email}" th:text="${customer.email}">
                                            john@email.com
                                        </a>
                                    </div>
                                </div>
                                <div class="info-item">
                                    <div class="info-label">
                                        <span class="material-symbols-outlined">phone</span>
                                        Số điện thoại:
                                    </div>
                                    <div class="info-value">
                                        <a th:href="'tel:' + ${customer.phone}" th:text="${customer.phone}">
                                            0123456789
                                        </a>
                                    </div>
                                </div>
                                <div class="info-item">
                                    <div class="info-label">
                                        <span class="material-symbols-outlined">verified_user</span>
                                        Loại tài khoản:
                                    </div>
                                    <div class="info-value">
                                        <span class="status-badge badge-customer">
                                            <span class="material-symbols-outlined">person</span>
                                            Khách hàng
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Account Status Card -->
                    <div class="info-card">
                        <div class="card-header">
                            <h3>
                                <span class="material-symbols-outlined">settings</span>
                                Trạng thái tài khoản
                            </h3>
                        </div>
                        <div class="card-body">
                            <div class="info-grid">
                                <div class="info-item">
                                    <div class="info-label">
                                        <span class="material-symbols-outlined">toggle_on</span>
                                        Trạng thái hiện tại:
                                    </div>
                                    <div class="info-value">
                                        <span th:switch="${customer.status}" class="status-badge">
                                            <span th:case="'ACTIVE'" class="status-active">
                                                <span class="material-symbols-outlined">check_circle</span>
                                                Hoạt động
                                            </span>
                                            <span th:case="'BANNED'" class="status-banned">
                                                <span class="material-symbols-outlined">block</span>
                                                Đã khóa
                                            </span>
                                        </span>
                                    </div>
                                </div>
                                <div class="info-item">
                                    <div class="info-label">
                                        <span class="material-symbols-outlined">calendar_add_on</span>
                                        Ngày tạo:
                                    </div>
                                    <div class="info-value"
                                        th:text="${#dates.format(customer.createdAt, 'dd/MM/yyyy HH:mm:ss')}">
                                        01/01/2024 10:00:00
                                    </div>
                                </div>
                                <div class="info-item">
                                    <div class="info-label">
                                        <span class="material-symbols-outlined">update</span>
                                        Lần cập nhật cuối:
                                    </div>
                                    <div class="info-value"
                                        th:text="${customer.updatedAt != null ? #dates.format(customer.updatedAt, 'dd/MM/yyyy HH:mm:ss') : 'Chưa cập nhật'}">
                                        02/01/2024 14:30:00
                                    </div>
                                </div>
                                <div class="info-item">
                                    <div class="info-label">
                                        <span class="material-symbols-outlined">image</span>
                                        Ảnh đại diện:
                                    </div>
                                    <div class="info-value">
                                        <div class="avatar-container">
                                            <img th:src="${customer.img_link != null ? customer.img_link : '/assets/images/default-avatar.png'}"
                                                alt="Avatar" class="avatar">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sidebar Content -->
                <div class="sidebar-content">
                    <!-- Actions Card -->
                    <div class="info-card">
                        <div class="card-header">
                            <h3>
                                <span class="material-symbols-outlined">build</span>
                                Thao tác
                            </h3>
                        </div>
                        <div class="card-body">
                            <div class="actions-section">
                                <a th:href="@{/admin/customer/{id}/edit(id=${customer.id})}" class="btn-warning">
                                    <span class="material-symbols-outlined">edit</span>
                                    Chỉnh sửa thông tin
                                </a>

                                <button th:if="${customer.status.name() == 'ACTIVE'}" type="button" class="btn-danger"
                                    th:data-customer-id="${customer.id}"
                                    th:data-customer-username="${customer.username}"
                                    onclick="confirmAction('ban', this.dataset.customerId, this.dataset.customerUsername)">
                                    <span class="material-symbols-outlined">block</span>
                                    Khóa tài khoản
                                </button>

                                <button th:if="${customer.status.name() == 'BANNED'}" type="button" class="btn-success"
                                    th:data-customer-id="${customer.id}"
                                    th:data-customer-username="${customer.username}"
                                    onclick="confirmAction('restore', this.dataset.customerId, this.dataset.customerUsername)">
                                    <span class="material-symbols-outlined">lock_open</span>
                                    Mở khóa tài khoản
                                </button>

                                <hr style="border: none; border-top: 1px solid #e2e8f0; margin: 1rem 0;">

                                <button type="button" class="btn-outline-info" onclick="printCustomerInfo()">
                                    <span class="material-symbols-outlined">print</span>
                                    In thông tin
                                </button>

                                <button type="button" class="btn-outline-success" onclick="exportCustomerInfo()">
                                    <span class="material-symbols-outlined">download</span>
                                    Xuất PDF
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Stats Card -->
                    <div class="info-card">
                        <div class="card-header">
                            <h3>
                                <span class="material-symbols-outlined">analytics</span>
                                Thống kê nhanh
                            </h3>
                        </div>
                        <div class="card-body">
                            <div class="stats-grid">
                                <div class="stat-item">
                                    <div class="stat-number primary">0</div>
                                    <div class="stat-label">Đơn hàng</div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-number success">0</div>
                                    <div class="stat-label">Yêu cầu</div>
                                </div>
                            </div>
                            <div style="margin-top: 1rem; text-align: center;">
                                <small style="color: #6b7280; font-size: 0.75rem;">
                                    <span class="material-symbols-outlined"
                                        style="font-size: 0.875rem; vertical-align: middle;">info</span>
                                    Thông tin chi tiết sẽ được cập nhật khi có dữ liệu
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Action Confirmation Modal -->
    <div id="actionModal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="actionModalTitle">
                    <span class="material-symbols-outlined">help</span>
                    Xác nhận thao tác
                </h3>
            </div>
            <div class="modal-body">
                <p id="actionModalMessage">Bạn có chắc chắn muốn thực hiện thao tác này?</p>
                <div class="alert alert-warning">
                    <span class="material-symbols-outlined">warning</span>
                    <div>
                        <strong>Lưu ý:</strong> Thao tác này sẽ ảnh hưởng đến khả năng đăng nhập của khách hàng.
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" onclick="hideModal()">Hủy</button>
                <form id="actionForm" method="post" style="display:inline;">
                    <button type="submit" class="btn-primary" id="actionButton">
                        <span class="material-symbols-outlined">check</span>
                        Xác nhận
                    </button>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script>
        function confirmAction(action, customerId, customerName) {
            const modal = document.getElementById('actionModal');
            const title = document.getElementById('actionModalTitle');
            const message = document.getElementById('actionModalMessage');
            const form = document.getElementById('actionForm');
            const button = document.getElementById('actionButton');

            if (action === 'ban') {
                title.innerHTML = '<span class="material-symbols-outlined">block</span> Xác nhận khóa tài khoản';
                message.innerHTML = `Bạn có chắc chắn muốn khóa tài khoản khách hàng <strong>${customerName}</strong>?`;
                form.action = `/admin/customer/${customerId}/delete`;
                button.className = 'btn-danger';
                button.innerHTML = '<span class="material-symbols-outlined">block</span> Khóa tài khoản';
            } else if (action === 'restore') {
                title.innerHTML = '<span class="material-symbols-outlined">lock_open</span> Xác nhận mở khóa';
                message.innerHTML = `Bạn có chắc chắn muốn mở khóa tài khoản khách hàng <strong>${customerName}</strong>?`;
                form.action = `/admin/customer/${customerId}/restore`;
                button.className = 'btn-success';
                button.innerHTML = '<span class="material-symbols-outlined">lock_open</span> Mở khóa';
            }

            modal.style.display = 'flex';
        }

        function hideModal() {
            document.getElementById('actionModal').style.display = 'none';
        }

        function printCustomerInfo() {
            window.print();
        }

        function exportCustomerInfo() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            // Title
            doc.setFontSize(20);
            doc.setFont("helvetica", "bold");
            doc.text("THÔNG TIN KHÁCH HÀNG", 20, 20);

            // Customer info
            doc.setFontSize(12);
            doc.setFont("helvetica", "normal");

            let y = 40;
            const customer = {
                id: document.querySelector('[th\\:text="${customer.id}"]')?.textContent || '',
                username: document.querySelector('[th\\:text="${customer.username}"]')?.textContent || '',
                fullname: document.querySelector('[th\\:text="${customer.fullname}"]')?.textContent || '',
                email: document.querySelector('[th\\:text="${customer.email}"]')?.textContent || '',
                phone: document.querySelector('[th\\:text="${customer.phone}"]')?.textContent || '',
                status: document.querySelector('.status-badge')?.textContent?.trim() || '',
                createdAt: document.querySelector('[th\\:text*="createdAt"]')?.textContent || ''
            };

            doc.text(`ID: ${customer.id}`, 20, y);
            y += 10;
            doc.text(`Tên đăng nhập: ${customer.username}`, 20, y);
            y += 10;
            doc.text(`Họ tên: ${customer.fullname}`, 20, y);
            y += 10;
            doc.text(`Email: ${customer.email}`, 20, y);
            y += 10;
            doc.text(`Số điện thoại: ${customer.phone}`, 20, y);
            y += 10;
            doc.text(`Trạng thái: ${customer.status}`, 20, y);
            y += 10;
            doc.text(`Ngày tạo: ${customer.createdAt}`, 20, y);

            // Footer
            y += 30;
            doc.setFontSize(10);
            doc.text(`Xuất lúc: ${new Date().toLocaleString('vi-VN')}`, 20, y);

            doc.save(`khach-hang-${customer.username}.pdf`);
        }

        // Close modal when clicking outside
        document.getElementById('actionModal').addEventListener('click', function (e) {
            if (e.target === this) {
                hideModal();
            }
        });
    </script>
</body>

</html>